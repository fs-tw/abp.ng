{"version":3,"file":"fs-permission-management-ng-alain.js","sources":["../../../../libs/permission-management/ng-alain/src/lib/components/permission-management.component.ts","../../../../libs/permission-management/ng-alain/src/lib/permission-management-ng-alain.module.ts","../../../../libs/permission-management/ng-alain/src/fs-permission-management-ng-alain.ts"],"sourcesContent":["import { PermissionManagementComponent as AbpPermissionManagementComponent, PermissionManagement } from '@abp/ng.permission-management';\r\nimport { Component, Renderer2, Input, Output, EventEmitter } from '@angular/core';\r\nimport { Store } from '@ngxs/store';\r\nimport { take } from 'rxjs/operators';\r\n@Component({\r\n  selector: 'ng-alain-permission-management',\r\n  styleUrls: ['./permission-management.component.less'],\r\n  templateUrl: './permission-management.component.html'\r\n})\r\nexport class PermissionManagementComponent extends AbpPermissionManagementComponent\r\n  implements\r\n  PermissionManagement.PermissionManagementComponentInputs,\r\n  PermissionManagement.PermissionManagementComponentOutputs {\r\n  @Input()\r\n  readonly providerName: string;\r\n\r\n  @Input()\r\n  readonly providerKey: string;\r\n\r\n  @Input()\r\n  readonly hideBadges = false;\r\n\r\n  protected _visible = false;\r\n\r\n  @Input()\r\n  get visible(): boolean {\r\n    return this._visible;\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    if (value === this._visible) return;\r\n\r\n    if (value) {\r\n      this.openModal().subscribe(() => {\r\n        this._visible = true;\r\n        this.visibleChange.emit(true);\r\n      });\r\n    } else {\r\n      this.selectedGroup = null;\r\n      this._visible = false;\r\n      this.visibleChange.emit(false);\r\n    }\r\n  }\r\n\r\n  @Output() readonly visibleChange = new EventEmitter<boolean>();\r\n\r\n  selectAllIndeterminate = false;\r\n  selectAllThisTabIndeterminate = false;\r\n  constructor(private _store: Store, private _renderer: Renderer2) {\r\n    super(_store, _renderer);\r\n  }\r\n  isGrantedByOtherProviderName(grantedProviders: PermissionManagement.GrantedProvider[]): boolean {\r\n    if (grantedProviders.length) {\r\n      return grantedProviders.findIndex(p => p.providerName !== this.providerName) > -1;\r\n    }\r\n    return false;\r\n  }\r\n  onClickSelectAll() {\r\n    this.selectAllIndeterminate = false;\r\n    this.permissions = this.permissions.map(permission => ({\r\n      ...permission,\r\n      isGranted: this.isGrantedByOtherProviderName(permission.grantedProviders) || this.selectAllTab,\r\n    }));\r\n\r\n    this.selectThisTab = this.selectAllTab;\r\n  }\r\n  onClickSelectThisTab() {\r\n    this.selectAllThisTabIndeterminate = false;\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      permissions.forEach(permission => {\r\n        if (permission.isGranted && this.isGrantedByOtherProviderName(permission.grantedProviders)) return;\r\n\r\n        const index = this.permissions.findIndex(per => per.name === permission.name);\r\n\r\n        this.permissions = [\r\n          ...this.permissions.slice(0, index),\r\n          { ...this.permissions[index], isGranted: this.selectThisTab },\r\n          ...this.permissions.slice(index + 1)\r\n        ];\r\n      });\r\n    });\r\n\r\n    this.setGrantCheckboxState();\r\n  }\r\n  onClickCheckbox(clickedPermission: PermissionManagement.Permission) {\r\n    if (clickedPermission.isGranted && this.isGrantedByOtherProviderName(clickedPermission.grantedProviders)) return;\r\n    setTimeout(() => {\r\n      this.permissions = this.permissions.map(per => {\r\n        if (clickedPermission.name === per.name) {\r\n          return { ...per, isGranted: !per.isGranted };\r\n        } else if (clickedPermission.name === per.parentName && clickedPermission.isGranted) {\r\n          return { ...per, isGranted: false };\r\n        } else if (clickedPermission.parentName === per.name && !clickedPermission.isGranted) {\r\n          return { ...per, isGranted: true };\r\n        }\r\n\r\n        return per;\r\n      });\r\n\r\n      this.setTabCheckboxState();\r\n      this.setGrantCheckboxState();\r\n    }, 0);\r\n  }\r\n  setTabCheckboxState() {\r\n    this.selectedGroupPermissions$.pipe(take(1)).subscribe(permissions => {\r\n      const selectedPermissions = permissions.filter(per => per.isGranted);\r\n      if (selectedPermissions.length === permissions.length) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = true;\r\n      } else if (selectedPermissions.length === 0) {\r\n        this.selectAllThisTabIndeterminate = false;\r\n        this.selectThisTab = false;\r\n      } else {\r\n        this.selectAllThisTabIndeterminate = true;\r\n      }\r\n    });\r\n  }\r\n  setGrantCheckboxState() {\r\n    const selectedAllPermissions = this.permissions.filter(per => per.isGranted);\r\n\r\n    if (selectedAllPermissions.length === this.permissions.length) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = true;\r\n    } else if (selectedAllPermissions.length === 0) {\r\n      this.selectAllIndeterminate = false;\r\n      this.selectAllTab = false;\r\n    } else {\r\n      this.selectAllIndeterminate = true;\r\n    }\r\n  }\r\n}\r\n\r\n","\r\nimport { NgModule } from '@angular/core';\r\nimport { NgAlainBasicModule } from '@fs/ng-alain/basic';\r\nimport { PermissionManagementComponent } from './components/permission-management.component';\r\nimport { CoreModule } from '@abp/ng.core';\r\nimport { PermissionManagementModule } from '@abp/ng.permission-management';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CoreModule,\r\n    NgAlainBasicModule,\r\n    PermissionManagementModule\r\n  ],\r\n  exports: [\r\n    PermissionManagementComponent\r\n  ],\r\n  declarations: [PermissionManagementComponent],\r\n  entryComponents: [PermissionManagementComponent]\r\n})\r\nexport class PermissionManagementNgAlainModule { }\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["AbpPermissionManagementComponent"],"mappings":"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"}