!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@fs/ng-alain/shared"),require("@fs/ng-alain/layout"),require("@angular/core"),require("@abp/ng.core"),require("@ngxs/store"),require("ng-zorro-antd"),require("lodash"),require("@fs/theme.core")):"function"==typeof define&&define.amd?define("@fs/ng-alain/basic",["exports","@fs/ng-alain/shared","@fs/ng-alain/layout","@angular/core","@abp/ng.core","@ngxs/store","ng-zorro-antd","lodash","@fs/theme.core"],n):n(((e="undefined"!=typeof globalThis?globalThis:e||self).fs=e.fs||{},e.fs["ng-alain"]=e.fs["ng-alain"]||{},e.fs["ng-alain"].basic={}),e.fs["ng-alain"].shared,e.fs["ng-alain"].layout,e.ng.core,e.ng_core,e.store,e.ngZorroAntd,e._,e.theme_core)}(this,(function(e,n,t,o,r,i,a,p,d){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function s(e,n,t,o){var r,i=arguments.length,a=i<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,n,t,o);else for(var p=e.length-1;p>=0;p--)(r=e[p])&&(a=(i<3?r(a):i>3?r(n,t,a):r(n,t))||a);return i>3&&a&&Object.defineProperty(n,t,a),a}function l(e,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,n)}var c,u=[{provide:o.APP_INITIALIZER,useFactory:h,deps:[i.Store],multi:!0}];function h(e){return function(){!function(e){e.dispatch([new r.AddReplaceableComponent({key:"Theme.ApplicationLayoutComponent",component:t.LayoutDefaultComponent}),new r.AddReplaceableComponent({key:"Theme.AccountLayoutComponent",component:t.LayoutPassportComponent}),new r.AddReplaceableComponent({key:"Theme.EmptyLayoutComponent",component:t.LayoutFullScreenComponent}),new r.AddReplaceableComponent({key:"ThemeCore.PageBarComponent",component:t.PageBarComponent})])}(e)}}e.FsNgAlainTreeComponent=function(){function e(){this.blockNode=!0,this.showCountType=0,this.tree=[],this.treeItem=[],this.nzDefaultExpandAll=!1,this.defaultExpandedKeys=[],this.nzShowLine=!1,this.defaultSelectedKeys=[],this.nzCheckable=!1,this.defaultCheckedKeys=[],this.showCheckAll=!1,this.checkAllText="全部",this.nzDraggable=!1,this.leafNodes=!1,this.nzDefaultSearch=!1,this.searchValue="",this.nzAsyncData=!1,this.onDropAction=new o.EventEmitter,this.onNodeClick=new o.EventEmitter,this.onNodeDblClick=new o.EventEmitter,this.onCheckBoxChange=new o.EventEmitter,this.onSearch=new o.EventEmitter,this.onExpandChange=new o.EventEmitter,this.treeOptions=[]}return e.prototype.ngOnInit=function(){this.init()},e.prototype.init=function(){var e=this,n=this.initTreeDatas(p.cloneDeep(this.tree));this.initTreeDatas(p.cloneDeep(this.treeItem));this.showCheckAll&&(n=this.createCheckAll(n)),this.leafNodes&&(n=this.setLeaf(n)),n=this.calcNodeNum(n);var t=this.array2Nodes(n);0!=this.showCountType&&(t=this.showCount(t)),this.treeOptions=[],t.forEach((function(n){e.treeOptions.push(new a.NzTreeNode(n))}))},e.prototype.initTreeDatas=function(e){return e=e.map((function(e){return e.title=e.displayName,e.key=e.id,delete e.children,e}))},e.prototype.createCheckAll=function(e){return(e=e.map((function(e){return null==e.parentId&&(e.parentId=0),e.code="0."+e.code,e}))).push({id:0,key:0,parentId:null,title:this.checkAllText,code:"0"}),e},e.prototype.calcNodeNum=function(e){var n=this;switch(this.showCountType){case 1:e=e.map((function(e,n,t){return e.childNum=t.filter((function(n){return e.id==n.parentId&&e.id!=n.id})).length,e}));break;case 2:e=e.map((function(e,n,t){return e.childNum=t.filter((function(n){return n.code.startsWith(e.code)&&e.id!=n.id})).length,e}));break;case 3:e=e.map((function(e){return e.childNum=n.treeItem.filter((function(n){return n.parentId==e.id})).length,e}));break;case 4:e=e.map((function(e){return e.childNum=n.treeItem.filter((function(n){return("0."+n.code).startsWith(e.code)})).length,e}))}return e},e.prototype.setLeaf=function(e){return e=e.map((function(e,n,t){return-1==t.findIndex((function(n){return n.parentId==e.id}))&&(e.isLeaf=!0),e}))},e.prototype.showCount=function(e){var n=this;return e.forEach((function(e){e.children&&(e.children=n.showCount(e.children)),(!e.isLeaf||n.showCountType>2)&&(e.title+="("+e.childNum+")")})),e},e.prototype.nodeClick=function(e){this.onNodeClick.emit(e)},e.prototype.expandChange=function(e){this.onExpandChange.emit(e)},e.prototype.nodeDblClick=function(e){e instanceof a.NzTreeNode?e.isExpanded=!e.isExpanded:e.node.isExpanded=!e.node.isExpanded,this.onNodeDblClick.emit(e)},e.prototype.nodeCheckBoxChange=function(e){this.onCheckBoxChange.emit(e)},e.prototype.getChecked=function(e){void 0===e&&(e="id");var n=this.nodes2Array(p.cloneDeep(this.treeOptions)).filter((function(e){return e.isChecked&&0!=e.key})).map((function(e){return e.key})),t=p.cloneDeep(this.tree).filter((function(e){return n.includes(e.id)}));return"*all"==e.toLowerCase()?t:t.map((function(n){return n[e]}))},e.prototype.treeStatusChange=function(e,n){void 0===n&&(n=!1),this.statusChange(this.treeOptions,e,n)},e.prototype.statusChange=function(e,n,t){void 0===t&&(t=!1);if(e instanceof Array)for(var o=0,r=e.length;o<r;o++)e[o][n]=t,"isChecked"==n&&0==t&&(e[o].isHalfChecked=!1),e[o].children&&this.statusChange(e[o].children,n,t);else e[n]=t,"isChecked"==n&&0==t&&(e.isHalfChecked=!1),e.children&&this.statusChange(e.children,n,t)},e.prototype.dropAction=function(e){var n={node:e.dragNode.key,parent:0};e.dragNode.parentNode&&e.dragNode.parentNode.key&&(n.parent=e.dragNode.parentNode.key),e.dragNode.origin.parentId=n.parent;var t=this.nodes2Array(p.cloneDeep(this.treeOptions)).filter((function(e){return e.origin.id})).map((function(e,n,t){var o=e.origin.parentId?e.origin.parentId:null,r=t.filter((function(n){return n.origin.parentId==e.origin.parentId})).findIndex((function(n){return n.key==e.key}));return{id:e.origin.id,parentId:o,order:r}}));this.onDropAction.emit({drag:n,datas:t})},e.prototype.nzOnSearch=function(e){this.onSearch.emit(e)},e.prototype.array2Nodes=function(e){var n,t;if(!e)return[];if(e instanceof Array){var o=[],r={};for(n=0,t=e.length;n<t;n++)r[e[n].id]=e[n];for(n=0,t=e.length;n<t;n++)r[e[n].parentId]&&e[n].id!=e[n].parentId?(r[e[n].parentId].children||(r[e[n].parentId].children=[]),r[e[n].parentId].children.push(e[n])):o.push(e[n]);return o}return[e]},e.prototype.nodes2Array=function(e){if(!e)return[];var n=[];if(e instanceof Array)for(var t=0,o=e.length;t<o;t++)n.push(e[t]),e[t].children&&(n=n.concat(this.nodes2Array(e[t].children)));else n.push(e),e.children&&(n=n.concat(this.nodes2Array(e.children)));return n},e}(),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"blockNode",void 0),s([o.Input(),l("design:type",Number)],e.FsNgAlainTreeComponent.prototype,"showCountType",void 0),s([o.Input(),l("design:type",Array)],e.FsNgAlainTreeComponent.prototype,"tree",void 0),s([o.Input(),l("design:type",Array)],e.FsNgAlainTreeComponent.prototype,"treeItem",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"nzDefaultExpandAll",void 0),s([o.Input(),l("design:type",Array)],e.FsNgAlainTreeComponent.prototype,"defaultExpandedKeys",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"nzShowLine",void 0),s([o.Input(),l("design:type",Array)],e.FsNgAlainTreeComponent.prototype,"defaultSelectedKeys",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"nzCheckable",void 0),s([o.Input(),l("design:type",Array)],e.FsNgAlainTreeComponent.prototype,"defaultCheckedKeys",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"showCheckAll",void 0),s([o.Input(),l("design:type",String)],e.FsNgAlainTreeComponent.prototype,"checkAllText",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"nzDraggable",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"leafNodes",void 0),s([o.Input(),l("design:type",o.TemplateRef)],e.FsNgAlainTreeComponent.prototype,"nzTreeTemplate",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"nzDefaultSearch",void 0),s([o.Input(),l("design:type",String)],e.FsNgAlainTreeComponent.prototype,"searchValue",void 0),s([o.Input(),l("design:type",Boolean)],e.FsNgAlainTreeComponent.prototype,"nzAsyncData",void 0),s([o.Output(),l("design:type",o.EventEmitter)],e.FsNgAlainTreeComponent.prototype,"onDropAction",void 0),s([o.Output(),l("design:type",o.EventEmitter)],e.FsNgAlainTreeComponent.prototype,"onNodeClick",void 0),s([o.Output(),l("design:type",o.EventEmitter)],e.FsNgAlainTreeComponent.prototype,"onNodeDblClick",void 0),s([o.Output(),l("design:type",o.EventEmitter)],e.FsNgAlainTreeComponent.prototype,"onCheckBoxChange",void 0),s([o.Output(),l("design:type",o.EventEmitter)],e.FsNgAlainTreeComponent.prototype,"onSearch",void 0),s([o.Output(),l("design:type",o.EventEmitter)],e.FsNgAlainTreeComponent.prototype,"onExpandChange",void 0),e.FsNgAlainTreeComponent=s([o.Component({selector:"fs-ng-alain-tree",template:'<nz-input-group [nzSuffix]="suffixIcon" *ngIf="nzDefaultSearch">\r\n    <input type="text" nz-input placeholder="Search" [(ngModel)]="searchValue" />\r\n</nz-input-group>\r\n<ng-template #suffixIcon>\r\n    <i nz-icon nzType="search"></i>\r\n</ng-template>\r\n<nz-tree\r\n    [nzBlockNode]="blockNode"\r\n    [nzData]="treeOptions"\r\n    [nzExpandAll]="nzDefaultExpandAll"\r\n    [nzExpandedKeys]="defaultExpandedKeys"\r\n    [nzShowLine]="nzShowLine"\r\n    [nzSelectedKeys]="defaultSelectedKeys"\r\n    [nzCheckable]="nzCheckable"\r\n    [nzCheckedKeys]="defaultCheckedKeys"\r\n    [nzDraggable]="nzDraggable"\r\n    (nzOnDrop)="dropAction($event)"\r\n    (nzClick)="nodeClick($event)"\r\n    (nzDblClick)="nodeDblClick($event)"\r\n    (nzCheckBoxChange)="nodeCheckBoxChange($event)"\r\n    [nzTreeTemplate]="nzTreeTemplate"\r\n    [nzSearchValue]="searchValue"\r\n    (nzSearchValueChange)="nzOnSearch($event)"\r\n    [nzAsyncData]="nzAsyncData"\r\n    (nzExpandChange)="expandChange($event)">\r\n</nz-tree>\r\n',styles:["::ng-deep .ant-tree-node-content-wrapper{width:100%}::ng-deep .ant-tree .ant-tree-node-content-wrapper.ant-tree-node-selected{background-color:#f5f5f5}"]}),l("design:paramtypes",[])],e.FsNgAlainTreeComponent),e.NgAlainBasicModule=c=function(){function e(){}return e.forRoot=function(){return{ngModule:c,providers:[u]}},e}(),e.NgAlainBasicModule=c=s([o.NgModule({declarations:[e.FsNgAlainTreeComponent],imports:[d.ThemeCoreModule,n.NgAlainSharedModule,t.LayoutModule],exports:[d.ThemeCoreModule,n.NgAlainSharedModule,e.FsNgAlainTreeComponent]})],e.NgAlainBasicModule),e.ɵa=u,e.ɵb=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=fs-ng-alain-basic.umd.min.js.map